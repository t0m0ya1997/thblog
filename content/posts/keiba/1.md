---
title: "100日後に競馬AIを構築する話(0)"
date: 2022-02-28
categories: [競馬, Research-ish]
tags: [競馬, C++, Python, 機械学習]
descriotion: "競馬AI構築0日目の記事。複利を計算してみる。"
math: true
draft: false
---

# はじめに
なんか競馬をやりたくなりました。
自分の頭を使ってやるのも良いですが、折角これまで機械学習の研究をしてきたので、世に蔓延る膨大なデータを用いて機械学習モデルを構築してみたいと思い始めました。
これから毎日、進捗を書き溜めていこうと思います。
目標設定なのですが、100日後に「競馬の予測ができる状態」を目指します。
ただ、僕はスケジューリングが大変苦手なので、早く終わってしまうことも、ましてや終わらないこともあるため、その点ご了承ください。

# 今日の内容
競馬投資シミュレーションを行います。
建前的に言うと、「将来的に競馬で稼げたらなぁ」という小さな欲がどれほど現実味のあることなのかを検証してみることにしました。
本音としては、`C++`の練習です。

シミュレーションにあたって以下を仮定します。
> * 馬券は1枚 $¥100$ である
> * 1年で $ N = 100$ 回の競馬に参加する
> * 1年で使える金額は $x^0 = ¥10,000$ とする
> * 競馬の出頭馬数は $8\sim 12$ 頭とする
> * 単勝にしか賭けられないとする

また、今回のシミュレーションは簡易的なものですので、適当に以下のパラメータを設定します。
> * 手元の資金のうち競馬にかけられる割合 $p = 0.02$
> * 単勝のオッズ $c = 10$
> * 単勝を的中することができる確率 $q$

$q$ はこれから作る機械学習モデルの性能に依存するため、この値を変えてシミュレーションを行います。

$n > 1$ 回の競馬に参加するにあたり行う処理は以下の通りです。
1. 前回の結果を踏まえた資金 $x^{(n-1)}$ の2%分を今回使える資金 $z^{(n)}$ とする。すなわち
$$
z^{(n)} = \text{max}\Biggl(0, \left\lfloor\frac{2x^{(n-1)}}{100} \times \frac{1}{100}\right\rfloor\times 100\Biggr)
\tag{1}
$$

例えば $¥960$ が手元にあったら、$960/100=9$, $9*100=900$ で，$¥100$ の馬券が9枚買えることになります．

2. 予測が的中した場合、$n$ 回目の競馬終了後の資金 $x^{(n)}$ は

$$
    x^{(n)} = \frac{98 x^{(n-1)}}{100} + cz^{(n)}
    \tag{2}
$$

となります。また、予測が外れてしまうと、

$$
    x^{(n)} = \frac{98 x^{(n-1)}}{100}
    \tag{3}
$$

となります。

# シミュレーション
$100$ 回の競馬の勝ち負けに関する組み合わせは $2^{100}$ 通りという膨大な数になります．
期待値を計算するためにはこれらの全組み合わせに対して平均を取る必要があるため、計算機をもってしても非常に莫大な時間がかかることがわかります。

今回は時系列が絡んできます。
ですので、**2項分布**を仮定してのモデリングは難しいため、今回は各レースを独立なものとして扱い、各レースで確率 $q$ で的中するとし、乱数シミュレーションを行ってみます。


各的中確率 $q=[0.1, 0.2, 0.3, 0.4, 0.5]$ におけるシミュレーションを それぞれ $50,000$ 回ずつ行いました。
$100$ 回のレース終了時における金額の最高金額、最低金額、中央値、平均値をそれぞれ以下の表に示します。

|  的中確率 $q$  |  最小値  |　最大値  |  中央値  |  平均値  |
| ---- | ---- | ---- | ---- |  ----  |
|  0.1  |  4,900  |  93,900  |  9,000  |  10,025  |
|  0.2  |  4,900  |  1,082,200  |  41,400  |  55,206 |
|  0.3  |  12,400  |  10,076,700  |  254,000  |  370,584  |
|  0.4  |  38,900  |  79,480,800  |  1,611,300  |  2,448,044 |
|  0.5  |  216,200  |  785,469,400  |  10,172,800  | 15,726,464 |

「…これはまともな結果なのだろうか？」
そんな感じの結果になりましたね。
的中確率が $0.3$ というのは、一番人気の馬券を買って単勝が当たる確率のようです。
結果だけ見ると、１万円が37万円に増えていますね。
そんなわけあるかい！と思います。
一番人気のオッズが $10$ 倍なんてそうそうならないと思います。
かなーーーーーーーーり、理想化した数値であることをご了承ください。

というか、<mark>一番人気にかけ続けてこれだけの利益が出るならとっくにみんなやっていますよね</mark>って話です。

# まとめ
今日は**ざっくりとした**競馬を続けた際のシミュレーションを行いました。
オッズや的中確率は適当に決めた数値で、かなり理想化された結果になっておりますので、その点ご了承ください。
稼げるようになりたいですね。以上。
